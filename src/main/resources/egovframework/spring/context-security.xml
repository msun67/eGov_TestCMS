<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
    xmlns="http://www.springframework.org/schema/security"
    xmlns:beans="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:security="http://www.springframework.org/schema/security"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/security 
        http://www.springframework.org/schema/security/spring-security.xsd">
        
    <!-- ì •ì  ìžì›ì€ í•„í„° ì²´ì¸ ì¸ì¦ ì œì™¸ (ë„¤ì´ë²„ìŠ¤ë§ˆíŠ¸ì—ë””í„°) -->
   	<http pattern="/resources/**" security="none"/>
	<http pattern="/css/**"       security="none"/>
	<http pattern="/js/**"        security="none"/>
	<http pattern="/images/**"    security="none"/>

    <!-- ðŸ”¹ ì ‘ê·¼ ê¶Œí•œ ì„¤ì • -->
    <http auto-config="false" use-expressions="true" entry-point-ref="authenticationEntryPoint">
        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ìž… íŽ˜ì´ì§€ëŠ” ëª¨ë‘ í—ˆìš© -->
        <intercept-url pattern="/main.do" access="permitAll"/>
        <intercept-url pattern="/loginProcess.do" access="permitAll"/>
        <intercept-url pattern="/signup.do" access="permitAll"/>
        <intercept-url pattern="/signupProcess.do" access="permitAll"/>
        <intercept-url pattern="/checkUserId.do" access="permitAll"/>
        <intercept-url pattern="/dashboard.do" access="isAuthenticated()" />

        <!-- ê¶Œí•œë³„ ì ‘ê·¼ íŽ˜ì´ì§€ -->
        <intercept-url pattern="/admin/**" access="hasRole('ROLE_ADMIN')"/>
        <intercept-url pattern="/org/**" access="hasRole('ROLE_ORG')"/>
        <intercept-url pattern="/user/**" access="hasRole('ROLE_USER')"/>
        <intercept-url pattern="/**" access="isAuthenticated()"/>

        <!-- ðŸ”¹ form-login ëŒ€ì‹  Custom Filter ì‚¬ìš© -->
        <custom-filter position="FORM_LOGIN_FILTER" ref="customAuthenticationFilter"/>

		
        <logout logout-url="/logout.do" logout-success-url="/main.do" invalidate-session="true"  delete-cookies="JSESSIONID"/>
        
        <!-- âœ… ê²Œì‹œíŒ ê¶Œí•œ ê±°ë¶€ ì‹œ: /board.doë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ + ì„¸ì…˜ ë©”ì‹œì§€ -->
    	<access-denied-handler ref="customSecurityHandler"/>
        <csrf disabled="false"/>
    </http>

    <!-- ðŸ”¹ ë¡œê·¸ì¸ íŽ˜ì´ì§€ (ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìžê°€ ì ‘ê·¼ ì‹œ) -->
    <beans:bean id="authenticationEntryPoint"
                class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <beans:constructor-arg value="/main.do"/>
    </beans:bean>

    <!-- âœ… Custom Authentication Provider -->
    <beans:bean id="customAuthenticationProvider"
                class="egovframework.cms.member.security.provider.CustomAuthenticationProvider">
        <beans:property name="passwordEncoder" ref="passwordEncoder"/>
    </beans:bean>

    <!-- âœ… Custom Authentication Filter -->
    <beans:bean id="customAuthenticationFilter"
                class="egovframework.cms.member.security.filter.CustomAuthenticationFilter">
        <beans:property name="authenticationManager" ref="authenticationManager"/>
        <beans:property name="filterProcessesUrl" value="/loginProcess.do"/>
        <beans:property name="usernameParameter" value="username"/>
        <beans:property name="passwordParameter" value="password"/>
        <beans:property name="userTypeParameter" value="userType"/>
        <beans:property name="authenticationSuccessHandler" ref="customAuthSuccessHandler"/>
        <beans:property name="authenticationFailureHandler" ref="customSecurityHandler"/>
    </beans:bean>

    <!-- âœ… Authentication Manager -->
    <authentication-manager alias="authenticationManager">
        <authentication-provider ref="customAuthenticationProvider"/>
    </authentication-manager>

    <!-- âœ… ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” -->
    <beans:bean id="passwordEncoder"
                class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>

    <!-- âœ… ë¡œê·¸ì¸ ì„±ê³µ í•¸ë“¤ëŸ¬ -->
    <beans:bean id="customAuthSuccessHandler"
                class="egovframework.cms.member.security.handler.CustomAuthSuccessHandler"/>
    
    <!-- âœ… ë¡œê·¸ì¸ ì‹¤íŒ¨ + ê¶Œí•œ ê±°ë¶€ë¥¼ ê²¸ìž„í•˜ëŠ” í•¸ë“¤ëŸ¬ -->            
    <beans:bean id="customSecurityHandler"
                class="egovframework.cms.member.security.handler.CustomSecurityHandler"/>
    
    <!-- âœ… ê²Œì‹œíŒ ê²Œì‹œê¸€ ì†Œìœ ìž/ê´€ë¦¬ìž í™•ì¸ -->
    <beans:bean id="boardSecurity" 
    			class="egovframework.cms.member.security.board.BoardSecurity"/>  

</beans:beans>
